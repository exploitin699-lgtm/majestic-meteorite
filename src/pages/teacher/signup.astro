---
export const prerender = false

import MainLayout from "../../layouts/MainLayout.astro";
import {supabase}from "../../lib/supabase";

const SUBJECTS = [
  "Mathematics",
  "Physics",
  "Chemistry",
  "Biology",
  "Geography",
  "History and Political Education",
  "English",
  "Literature in English",
  "Kiswahili",
  "French",
  "German",
  "Chinese",
  "Arabic",
  "ICT",
  "CRE",
  "Entrepreneurship",
  "Technology and Design",
  "Fine Art",
  "Performing Arts",
  "Agriculture",
  "Food and Nutrition Technology",
  "Physical Education",
  "Religious Education",
  "IRE",
  "Local Languages"
];

const CLASSES = ["S1","S2","S3","S4","S5","S6"];
---

<MainLayout title="Teacher Signup">

<section class="section">

<h1>üë©üèΩ‚Äçüè´ Teacher registration</h1>

<form id="teacherForm" class="card form">

<label>
Full name
<input type="text" name="full_name" required />
</label>

<label>
Email
<input type="email" name="email" required />
</label>

<label>
Password
<input type="password" name="password" required />
</label>

<h3>Subjects you teach</h3>
<div class="grid small">
  {SUBJECTS.map(s => (
    <label class="check">
      <input type="checkbox" name="subjects" value={s} />
      {s}
    </label>
  ))}
</div>

<h3>Classes you teach</h3>
<div class="grid small">
  {CLASSES.map(c => (
    <label class="check">
      <input type="checkbox" name="class_levels" value={c} />
      {c}
    </label>
  ))}
</div>

<p id="formMsg" style="color:red;"></p>

<button type="submit" class="primary">
Create account
</button>

</form>

</section>

<script>
const form = document.getElementById("teacherForm");
const msg  = document.getElementById("formMsg");

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const fd = new FormData(form);

  const full_name = fd.get("full_name");
  const email = fd.get("email");
  const password = fd.get("password");
  const subjects = fd.getAll("subjects");
  const class_levels = fd.getAll("class_levels");

  msg.textContent = "Creating account...";

  try {

    const res = await fetch("/api/teacher-signup", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        full_name,
        email,
        password,
        subjects,
        class_levels
      })
    });

    const data = await res.json();

    if (!res.ok) {
      msg.textContent = data.error || "Signup failed";
      return;
    }

    // success
    window.location.href = "/teacher/dashboard";

  } catch (err) {
    msg.textContent = "Network error. Try again.";
  }
});
</script>

</MainLayout>
